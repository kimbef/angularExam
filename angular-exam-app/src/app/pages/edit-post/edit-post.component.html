<div class="edit-post-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading post...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !post" class="error-state">
    <div class="error-icon">⚠️</div>
    <p>{{ error }}</p>
    <a routerLink="/my-posts" class="btn btn-primary">Back to My Posts</a>
  </div>

  <!-- Edit Form -->
  <div *ngIf="!isLoading && post" class="edit-post-content">
    <div class="edit-post-header">
      <div class="header-content">
        <h1>Edit Post</h1>
        <p>Update your content and settings</p>
      </div>
      <div class="header-actions">
        <a routerLink="/my-posts" class="btn btn-outline">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" class="btn-icon">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
          Back to My Posts
        </a>
      </div>
    </div>

    <form [formGroup]="postForm" (ngSubmit)="onSubmit()" class="post-form">
      <!-- Title -->
      <div class="form-group">
        <label for="title" class="form-label">Post Title *</label>
        <input
          type="text"
          id="title"
          formControlName="title"
          class="form-input"
          [class.error]="getFieldError('title')"
          placeholder="Enter an engaging title for your post"
        >
        <div class="field-error" *ngIf="getFieldError('title')">
          {{ getFieldError('title') }}
        </div>
        <div class="field-hint">
          {{ postForm.get('title')?.value?.length || 0 }}/100 characters
        </div>
      </div>

      <!-- Category -->
      <div class="form-group">
        <label for="category" class="form-label">Category *</label>
        <select
          id="category"
          formControlName="category"
          class="form-select"
          [class.error]="getFieldError('category')"
        >
          <option *ngFor="let category of categories" [value]="category">
            {{ category }}
          </option>
        </select>
        <div class="field-error" *ngIf="getFieldError('category')">
          {{ getFieldError('category') }}
        </div>
      </div>

      <!-- Image URL -->
      <div class="form-group">
        <label for="imageUrl" class="form-label">Featured Image URL</label>
        <div class="image-input-wrapper">
          <input
            type="url"
            id="imageUrl"
            formControlName="imageUrl"
            class="form-input"
            [class.error]="getFieldError('imageUrl')"
            placeholder="https://example.com/image.jpg"
          >
          <button type="button" (click)="generateRandomImage()" class="generate-image-btn">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" class="btn-icon">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            Random Image
          </button>
        </div>
        <div class="field-error" *ngIf="getFieldError('imageUrl')">
          {{ getFieldError('imageUrl') }}
        </div>
        <div class="image-preview" *ngIf="postForm.get('imageUrl')?.value">
          <img [src]="postForm.get('imageUrl')?.value" alt="Preview" loading="lazy">
        </div>
      </div>

      <!-- Content -->
      <div class="form-group">
        <label for="content" class="form-label">Content *</label>
        <textarea
          id="content"
          formControlName="content"
          class="form-textarea"
          [class.error]="getFieldError('content')"
          placeholder="Write your post content here..."
          rows="12"
        ></textarea>
        <div class="field-error" *ngIf="getFieldError('content')">
          {{ getFieldError('content') }}
        </div>
        <div class="field-hint">
          {{ postForm.get('content')?.value?.length || 0 }} characters (minimum 50)
        </div>
      </div>

      <!-- Excerpt -->
      <div class="form-group">
        <label for="excerpt" class="form-label">Excerpt *</label>
        <textarea
          id="excerpt"
          formControlName="excerpt"
          class="form-textarea"
          [class.error]="getFieldError('excerpt')"
          placeholder="Brief summary of your post"
          rows="3"
        ></textarea>
        <div class="field-error" *ngIf="getFieldError('excerpt')">
          {{ getFieldError('excerpt') }}
        </div>
        <div class="field-hint">
          {{ postForm.get('excerpt')?.value?.length || 0 }}/200 characters
        </div>
      </div>

      <!-- Tags -->
      <div class="form-group">
        <label class="form-label">Tags</label>
        <div class="tags-section">
          <div class="available-tags">
            <button
              type="button"
              *ngFor="let tag of availableTags"
              class="tag-btn"
              [class.selected]="isTagSelected(tag)"
              (click)="toggleTag(tag)"
            >
              #{{ tag }}
            </button>
          </div>
          <div class="selected-tags" *ngIf="selectedTags.length > 0">
            <span class="selected-tags-label">Selected:</span>
            <span *ngFor="let tag of selectedTags" class="selected-tag">
              #{{ tag }}
            </span>
          </div>
        </div>
      </div>

      <!-- Publishing Options -->
      <div class="form-group">
        <div class="publish-options">
          <label class="checkbox-label">
            <input
              type="checkbox"
              formControlName="isPublished"
              class="checkbox-input"
            >
            <span class="checkbox-custom"></span>
            <span class="checkbox-text">Published</span>
          </label>
          <p class="publish-hint">
            Check to make this post visible to the public. Uncheck to save as draft.
          </p>
        </div>
      </div>

      <!-- Error Message -->
      <div class="error-message" *ngIf="error">
        <svg fill="currentColor" viewBox="0 0 20 20" class="error-icon">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
        </svg>
        {{ error }}
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button
          type="button"
          (click)="saveDraft()"
          class="btn btn-outline"
          [disabled]="isSaving || !postForm.get('title')?.value || !postForm.get('content')?.value"
        >
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" class="btn-icon">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"></path>
          </svg>
          Save as Draft
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="isSaving || postForm.invalid"
          [class.loading]="isSaving"
        >
          <span *ngIf="!isSaving">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" class="btn-icon">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            Update Post
          </span>
          <span *ngIf="isSaving" class="loading-content">
            <div class="spinner"></div>
            Updating...
          </span>
        </button>
      </div>
    </form>
  </div>
</div>
