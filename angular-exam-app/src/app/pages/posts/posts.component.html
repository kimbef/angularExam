<div class="posts-container">
  <div class="posts-header">
    <h1>All Posts</h1>
    <p>Discover amazing stories from our community</p>
  </div>

  <!-- Search and Filter Section -->
  <div class="filters-section">
    <div class="search-wrapper">
      <input
        type="text"
        placeholder="Search posts, authors, or tags..."
        class="search-input"
        [value]="searchTerm"
        (input)="onSearchChange($event.target?.value || '')"
      >
      <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
      </svg>
    </div>

    <div class="category-filters">
      <button
        *ngFor="let category of categories"
        class="category-btn"
        [class.active]="selectedCategory === category || (category === 'All' && !selectedCategory)"
        (click)="onCategoryChange(category === 'All' ? '' : category)"
      >
        {{ category }}
      </button>
    </div>

    <div class="filter-actions" *ngIf="searchTerm || selectedCategory">
      <button class="clear-filters-btn" (click)="clearFilters()">
        Clear Filters
      </button>
      <span class="results-count">{{ filteredPosts.length }} result(s)</span>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading posts...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-state">
    <div class="error-icon">‚ö†Ô∏è</div>
    <p>{{ error }}</p>
    <button (click)="retryLoad()" class="btn btn-primary">Try Again</button>
  </div>

  <!-- Posts Grid -->
  <div *ngIf="!isLoading && !error" class="posts-content">
    <div *ngIf="filteredPosts.length === 0" class="empty-state">
      <div class="empty-icon">üìù</div>
      <h3>No posts found</h3>
      <p *ngIf="searchTerm || selectedCategory">Try adjusting your search or filter criteria.</p>
      <p *ngIf="!searchTerm && !selectedCategory">Be the first to share your story!</p>
      <button *ngIf="searchTerm || selectedCategory" (click)="clearFilters()" class="btn btn-outline">
        Clear Filters
      </button>
    </div>

    <div *ngIf="filteredPosts.length > 0" class="posts-grid">
      <article *ngFor="let post of filteredPosts; trackBy: trackByPostId" class="post-card">
        <div class="post-image">
          <img [src]="post.imageUrl" [alt]="post.title" loading="lazy">
          <div class="post-category">{{ post.category }}</div>
        </div>

        <div class="post-content">
          <div class="post-meta">
            <div class="author-info">
              <img [src]="post.author.avatar" [alt]="post.author.username" class="author-avatar">
              <div class="author-details">
                <span class="author-name">{{ post.author.username }}</span>
                <span class="post-date">{{ post.createdAt | date:'MMM d, y' }}</span>
              </div>
            </div>
          </div>

          <h3 class="post-title">
            <a [routerLink]="['/posts', post.id]">{{ post.title }}</a>
          </h3>

          <p class="post-excerpt">{{ post.excerpt }}</p>

          <div class="post-tags" *ngIf="post.tags.length > 0">
            <span *ngFor="let tag of post.tags.slice(0, 3)" class="tag">
              #{{ tag }}
            </span>
            <span *ngIf="post.tags.length > 3" class="tag-more">
              +{{ post.tags.length - 3 }} more
            </span>
          </div>

          <div class="post-actions">
            <div class="post-stats">
              <button
                class="stat-btn like-btn"
                [class.disabled]="!currentUser"
                [disabled]="!currentUser"
                (click)="likePost(post)"
                [title]="currentUser ? 'Like this post' : 'Login to like posts'"
              >
                <svg fill="currentColor" viewBox="0 0 20 20" class="stat-icon">
                  <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path>
                </svg>
                <span>{{ post.likes }}</span>
              </button>

              <button
                class="stat-btn dislike-btn"
                [class.disabled]="!currentUser"
                [disabled]="!currentUser"
                (click)="dislikePost(post)"
                [title]="currentUser ? 'Dislike this post' : 'Login to dislike posts'"
              >
                <svg fill="currentColor" viewBox="0 0 20 20" class="stat-icon">
                  <path fill-rule="evenodd" d="M18.707 8.707a1 1 0 00-1.414-1.414L10 14.586 2.707 7.293a1 1 0 00-1.414 1.414l8 8a1 1 0 001.414 0l8-8z" clip-rule="evenodd"></path>
                </svg>
                <span>{{ post.dislikes }}</span>
              </button>

              <div class="stat">
                <svg fill="currentColor" viewBox="0 0 20 20" class="stat-icon">
                  <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path>
                </svg>
                <span>{{ post.comments.length }}</span>
              </div>
            </div>

            <a [routerLink]="['/posts', post.id]" class="read-more-btn">
              Read More
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" class="arrow-icon">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </a>
          </div>
        </div>
      </article>
    </div>
  </div>
</div>
